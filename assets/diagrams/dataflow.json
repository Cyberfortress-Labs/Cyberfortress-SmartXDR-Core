{
  "workflow_name": "Intelligent SOC Ecosystem Pipeline",
  "version": "1.0",
  "description": "Operational data flow from log collection to automated response via SmartXDR",
  "phases": [
    {
      "phase_id": 1,
      "name": "Logs Collecting & Ingestion",
      "description": "Collection of raw logs from endpoints, network devices, and web servers.",
      "steps": [
        {
          "step_id": "1.1",
          "source": {
            "component": "Wazuh Agents",
            "type": "Endpoint",
            "segments": ["Guest Subnet", "WAN", "LAN/XDR Subnet"]
          },
          "action": "Ship Logs & Events",
          "destination": {
            "component": "Wazuh Server",
            "ip": "192.168.100.138",
            "protocol": "TCP/1514"
          },
          "data_type": "OSSEC Logs"
        },
        {
          "step_id": "1.2",
          "source": {
            "component": "Network Sensors",
            "devices": [
              { "name": "Suricata Inline IDPS", "ip": "192.168.100.171" },
              { "name": "Zeek NSM", "ip": "192.168.100.172" },
              { "name": "pfSense", "ip": "10.81.85.2" }
            ]
          },
          "action": "Ship Network Logs",
          "destination": {
            "component": "Logstash / Elastic Fleet",
            "ip": "192.168.100.128",
            "role": "SIEM Ingest"
          },
          "data_type": "EVE JSON, Zeek Logs, Syslog"
        }
      ]
    },
    {
      "phase_id": 2,
      "name": "Normalization & Pre-processing",
      "description": "Parsing raw logs into Elastic Common Schema (ECS) and preparing for ML.",
      "steps": [
        {
          "step_id": "2.1",
          "source": "Wazuh Server / Logstash",
          "action": "Parse & Normalize",
          "destination": "Elasticsearch",
          "ip": "192.168.100.128",
          "format": "ECS (Elastic Common Schema)"
        },
        {
          "step_id": "2.2",
          "source": "Elasticsearch",
          "action": "Fetch for Pre-processing",
          "destination": "SmartXDR Core",
          "ip": "192.168.100.158",
          "process": "SmartXDR Ingest Pipeline",
          "output_state": "ML-Ready Logs"
        }
      ]
    },
    {
      "phase_id": 3,
      "name": "Classification & Enrichment",
      "description": "AI analysis using SmartXDR models to classify threats and enrich log data.",
      "steps": [
        {
          "step_id": "3.1",
          "source": "SmartXDR Core",
          "action": "Machine Learning Analysis",
          "input": "ML-Ready Logs",
          "model_action": "Classification Logs",
          "destination": "Elasticsearch",
          "output_data": "Enriched & Indexed Logs"
        }
      ]
    },
    {
      "phase_id": 4,
      "name": "Alerting & Correlation",
      "description": "Rule-based detection combined with AI validation.",
      "steps": [
        {
          "step_id": "4.1",
          "source": "ElastAlert2",
          "ip": "192.168.100.168",
          "action": "Query & Match Rules",
          "target": "Elasticsearch",
          "trigger": "Threshold/Frequency Match"
        },
        {
          "step_id": "4.2",
          "source": "ElastAlert2",
          "action": "Consult AI",
          "destination": "SmartXDR Core",
          "ip": "192.168.100.158",
          "reason": "Reduce False Positives"
        },
        {
          "step_id": "4.3",
          "source": "ElastAlert2",
          "action": "Dispatch Alert",
          "destinations": [
            { "component": "DFIR-IRIS", "ip": "192.168.100.148" },
            { "component": "n8n", "ip": "192.168.100.158" }
          ]
        }
      ]
    },
    {
      "phase_id": 5,
      "name": "Incident Response (Orchestration)",
      "description": "Case management, Threat Intelligence lookup, and Analyst investigation.",
      "steps": [
        {
          "step_id": "5.1",
          "source": "DFIR-IRIS",
          "ip": "192.168.100.148",
          "action": "Create Case / Check Alerts",
          "trigger": "Inbound Alert from ElastAlert2/Wazuh"
        },
        {
          "step_id": "5.2",
          "source": "DFIR-IRIS",
          "action": "Request Intel Lookup",
          "destination": "IntelOwl",
          "hosted_on": "192.168.100.148"
        },
        {
          "step_id": "5.3",
          "source": "IntelOwl",
          "action": "Query Threat Data",
          "destination": "MISP Server",
          "ip": "192.168.100.130",
          "data_type": "IOCs (Hashes, IPs, Domains)"
        },
        {
          "step_id": "5.4",
          "source": "Analyst",
          "action": "Manual/AI Assisted Analysis",
          "tool": "SmartXDR Assistant",
          "context": "Case Management Interface"
        }
      ]
    },
    {
      "phase_id": 6,
      "name": "Automated Response",
      "description": "Execution of playbooks to mitigate threats and notify stakeholders.",
      "steps": [
        {
          "step_id": "6.1",
          "source": "DFIR-IRIS / ElastAlert2",
          "action": "Trigger Workflow",
          "destination": "n8n Automation",
          "ip": "192.168.100.158"
        },
        {
          "step_id": "6.2",
          "source": "n8n Automation",
          "action": "Execute Mitigation",
          "targets": [
            { "action": "Block IP", "device": "pfSense / Wazuh Active Response" },
            { "action": "Isolate Host", "device": "Wazuh Agent" }
          ]
        },
        {
          "step_id": "6.3",
          "source": "n8n Automation",
          "action": "Notification & Reporting",
          "outputs": [
            { "type": "Instant Message", "platform": "Telegram/Email" },
            { "type": "Document", "content": "Auto-gen Report" },
            { "type": "Evidence", "content": "Auto-record to Case" }
          ]
        }
      ]
    }
  ]
}